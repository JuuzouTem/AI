<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã‡oklu AI Sohbet ArayÃ¼zÃ¼ (OpenRouter Destekli)</title>
    <style>
        /* Genel Stil AyarlarÄ± */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: #1c1e21;
        }

        /* Ãœst KÄ±sÄ±m (API AnahtarlarÄ± ve Model SeÃ§imi) */
        .settings-container {
            background-color: #ffffff;
            padding: 15px 20px;
            border-bottom: 1px solid #dddfe2;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            max-height: 40vh; /* Ayar bÃ¶lÃ¼mÃ¼nÃ¼n Ã§ok bÃ¼yÃ¼mesini engelle */
            overflow-y: auto; /* Gerekirse kaydÄ±rma */
        }

        .settings-container h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #3b5998;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .provider-settings label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #606770;
        }

        .provider-settings input[type="password"],
        .provider-settings input[type="text"], /* Model input iÃ§in */
        .provider-settings select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        .active-selection {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e4e6eb;
            display: flex; /* Yan yana hizalama iÃ§in */
            flex-wrap: wrap; /* KÃ¼Ã§Ã¼k ekranlarda alt alta */
            gap: 15px;
            align-items: center;
        }
         .active-selection label {
             font-weight: bold;
             margin-right: 5px; /* Input/Select ile arasÄ±na boÅŸluk */
             white-space: nowrap; /* Etiketin kÄ±rÄ±lmasÄ±nÄ± engelle */
         }
         .active-selection select,
         .active-selection input[type="text"] { /* Model input iÃ§in */
              padding: 8px 10px;
              border: 1px solid #ccd0d5;
              border-radius: 6px;
              font-size: 14px;
              min-width: 180px; /* GeniÅŸlik ayarÄ± */
         }

        /* OpenRouter Model Input'u baÅŸlangÄ±Ã§ta gizle */
        #modelInputContainer {
            display: none;
        }

        /* Sohbet AlanÄ± */
        #chatbox {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 75%;
            line-height: 1.4;
            word-wrap: break-word;
            font-size: 0.95em;
        }

        .user-message {
            background-color: #0084ff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background-color: #e4e6eb;
            color: #050505;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            /* AI mesajlarÄ±nÄ±n iÃ§indeki kod bloklarÄ±nÄ±n taÅŸmasÄ±nÄ± engellemek iÃ§in */
            max-width: 90%; /* Daha geniÅŸ olabilir */
        }
         .ai-message .sender-tag {
             display: block;
             font-size: 0.75em;
             font-weight: bold;
             color: #606770;
             margin-bottom: 3px;
             opacity: 0.8;
         }

         .error-message {
            background-color: #fdecea;
            color: #a31a1a;
            border: 1px solid #f5c6cb;
            align-self: stretch; /* Tam geniÅŸlik */
            max-width: 100%;   /* Tam geniÅŸlik */
            border-radius: 6px;
            font-weight: bold;
         }

         .loading-message {
             font-style: italic;
             color: #606770;
             align-self: flex-start;
             background-color: #e4e6eb;
         }

        /* --- Kod BloÄŸu Stilleri --- */
        .code-wrapper {
            background-color: #282c34; /* Koyu arka plan */
            border-radius: 8px;
            margin-top: 8px; /* Mesaj metninden biraz boÅŸluk */
            overflow: hidden; /* Ä°Ã§erik taÅŸmasÄ±nÄ± engelle */
            border: 1px solid #4a4f58;
            /* max-width: 100%; KapsayÄ±cÄ±sÄ±nÄ±n geniÅŸliÄŸini aÅŸmamasÄ± iÃ§in */
        }

        .code-toolbar {
            display: flex;
            justify-content: space-between; /* Dil adÄ± sola, butonlar saÄŸa */
            align-items: center;
            background-color: #3c4048; /* Biraz daha aÃ§Ä±k toolbar */
            padding: 5px 12px;
            border-bottom: 1px solid #4a4f58;
        }

        .code-lang {
            font-size: 0.8em;
            color: #abb2bf; /* AÃ§Ä±k gri */
            font-weight: bold;
            text-transform: uppercase;
        }

        .code-toolbar button {
            background-color: #528bff; /* Mavi tonu */
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 8px; /* Butonlar arasÄ± boÅŸluk */
            transition: background-color 0.2s ease;
            display: inline-flex; /* Ä°kon ve metni yan yana hizala */
            align-items: center;
        }

        .code-toolbar button:hover {
            background-color: #4073d9; /* Hover rengi */
        }
        .code-toolbar button:disabled {
             background-color: #6c757d;
             cursor: not-allowed;
         }

         .code-toolbar button .btn-text { /* Sadece metin iÃ§in */
             margin-left: 4px; /* Ä°kon ve metin arasÄ± boÅŸluk */
         }

        .code-wrapper pre {
            margin: 0; /* pre etiketinin varsayÄ±lan margin'ini kaldÄ±r */
            padding: 15px;
            overflow-x: auto; /* Yatay kaydÄ±rma */
            background-color: transparent; /* Arka planÄ± wrapper'dan alÄ±r */
            color: #abb2bf; /* Kod rengi */
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            white-space: pre; /* BoÅŸluklarÄ± koru */
        }

        .code-wrapper pre code {
             display: block; /* Kodun tamamÄ±nÄ± kapsamasÄ± iÃ§in */
             box-sizing: border-box;
        }
        /* --- Kod BloÄŸu Stilleri BitiÅŸ --- */

        /* --- YENÄ°: Markdown Formatlama Stilleri --- */
        .ai-message strong {
            font-weight: bold;
        }

        .ai-message em {
            font-style: italic;
        }

        /* SatÄ±r iÃ§i kod iÃ§in. Kod bloÄŸundaki code ile Ã§akÄ±ÅŸmamasÄ± iÃ§in daha spesifik */
        .ai-message > div > p code,
        .ai-message > div > li code,
        .ai-message > div code:not(pre code) { /* pre iÃ§indeki code'larÄ± hariÃ§ tut */
            background-color: #f0f0f0; /* AÃ§Ä±k gri arka plan */
            padding: 0.1em 0.4em;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #333; /* Koyu gri metin */
            border: 1px solid #e0e0e0;
        }

        .ai-message ul,
        .ai-message ol {
            margin-top: 0.6em;
            margin-bottom: 0.6em;
            padding-left: 25px; /* Liste girintisi */
        }
        .ai-message ul ul, /* Ä°Ã§ iÃ§e listeler iÃ§in daha fazla girinti */
        .ai-message ol ol,
        .ai-message ul ol,
        .ai-message ol ul {
            margin-top: 0.2em;
            margin-bottom: 0.2em;
            padding-left: 20px;
        }

        .ai-message li {
            margin-bottom: 0.3em; /* Liste Ã¶ÄŸeleri arasÄ± boÅŸluk */
            line-height: 1.5; /* Liste Ã¶ÄŸelerinin okunabilirliÄŸi */
        }
         .ai-message p { /* Paragraflar arasÄ± boÅŸluk iÃ§in */
             margin-top: 0.5em;
             margin-bottom: 0.5em;
         }
         .ai-message p:first-child {
             margin-top: 0;
         }
          .ai-message p:last-child {
             margin-bottom: 0;
         }
        /* --- Markdown Formatlama Stilleri BitiÅŸ --- */


        /* GiriÅŸ AlanÄ± */
        .input-area {
            display: flex;
            padding: 10px 20px;
            background-color: #ffffff;
            border-top: 1px solid #dddfe2;
        }

        #userInput {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ccd0d5;
            border-radius: 20px;
            font-size: 15px;
            margin-right: 10px;
            outline: none;
        }
         #userInput:focus {
             border-color: #3b5998;
         }

        #sendButton {
            padding: 10px 20px;
            background-color: #3b5998;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }

        #sendButton:hover {
            background-color: #334d84;
        }
        #sendButton:disabled {
             background-color: #a0aec0;
             cursor: not-allowed;
         }

         /* GÃ¼venlik UyarÄ±sÄ± */
        .security-warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #ffeeba;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="security-warning">
        <strong>âš ï¸ CÄ°DDÄ° GÃœVENLÄ°K UYARISI:</strong> API anahtarlarÄ±nÄ±zÄ± tarayÄ±cÄ±ya girmek bÃ¼yÃ¼k bir risktir. Bu aracÄ± yalnÄ±zca %100 gÃ¼vendiÄŸiniz kiÅŸisel bilgisayarÄ±nÄ±zda kullanÄ±n. ASLA herkese aÃ§Ä±k veya paylaÅŸÄ±lan bilgisayarlarda kullanmayÄ±n.
    </div>

    <div class="settings-container">
        <h2>API AyarlarÄ± ve Model SeÃ§imi</h2>
        <div class="settings-grid">
            <div class="provider-settings">
                <label for="openrouterApiKey">OpenRouter API AnahtarÄ±:</label>
                <input type="password" id="openrouterApiKey" placeholder="sk-or-...">
            </div>
            <div class="provider-settings">
                <label for="openaiApiKey">OpenAI (ChatGPT) API AnahtarÄ±:</label>
                <input type="password" id="openaiApiKey" placeholder="sk-...">
            </div>
            <div class="provider-settings">
                <label for="geminiApiKey">Google Gemini API AnahtarÄ±:</label>
                <input type="password" id="geminiApiKey" placeholder="AIza...">
            </div>
             <div class="provider-settings">
                <label for="groqApiKey">Groq API AnahtarÄ±:</label>
                <input type="password" id="groqApiKey" placeholder="gsk_...">
            </div>
            <div class="provider-settings">
                <label for="claudeApiKey">Anthropic (Claude) API AnahtarÄ±:</label>
                <input type="password" id="claudeApiKey" placeholder="sk-ant-...">
                 <small style="font-size:11px; color:#666;">(Ek baÅŸlÄ±klar gerektirebilir)</small>
            </div>
            <div class="provider-settings">
                <label for="deepseekApiKey">DeepSeek API AnahtarÄ±:</label>
                <input type="password" id="deepseekApiKey" placeholder="dk_...">
                <small style="font-size:11px; color:#666;">(VarsayÄ±lan OpenAI formatÄ±)</small>
            </div>
             <div class="provider-settings">
                <label for="qwenApiKey">Qwen (Alibaba) API AnahtarÄ±:</label>
                <input type="password" id="qwenApiKey" placeholder="sk-...">
                <small style="font-size:11px; color:#666;">(VarsayÄ±lan OpenAI formatÄ±)</small>
            </div>
        </div>

        <div class="active-selection">
             <div>
                 <label for="aiProviderSelect">Aktif SaÄŸlayÄ±cÄ±:</label>
                 <select id="aiProviderSelect">
                     <option value="openrouter">OpenRouter</option>
                     <option value="openai">OpenAI (ChatGPT)</option>
                     <option value="gemini">Google Gemini</option>
                     <option value="groq">Groq</option>
                     <option value="claude">Anthropic Claude</option>
                     <option value="deepseek">DeepSeek (Deneysel)</option>
                     <option value="qwen">Qwen (Deneysel)</option>
                 </select>
             </div>
             <!-- Model SeÃ§im AlanÄ± (Dinamik olarak deÄŸiÅŸecek) -->
             <div id="modelSelectContainer">
                 <label for="modelSelect">Model:</label>
                 <select id="modelSelect">
                     <!-- Modeller JS ile doldurulacak -->
                 </select>
             </div>
             <div id="modelInputContainer">
                 <label for="modelInput">Model AdÄ±:</label>
                 <input type="text" id="modelInput" placeholder="Ã–rn: google/gemini-pro">
             </div>
        </div>
    </div>

    <div id="chatbox">
        <div class="message ai-message">
             <span class="sender-tag">Sistem</span>
             <div>Merhaba! Hangi AI ile sohbet etmek istersiniz? LÃ¼tfen ilgili API anahtarÄ±nÄ± girin, saÄŸlayÄ±cÄ±yÄ± ve modeli seÃ§in/girin.</div>
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="MesajÄ±nÄ±zÄ± buraya yazÄ±n...">
        <button id="sendButton">GÃ¶nder</button>
    </div>

    <script>
        // --- DOM Elementleri ---
        const chatbox = document.getElementById('chatbox');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const aiProviderSelect = document.getElementById('aiProviderSelect');
        const modelSelectContainer = document.getElementById('modelSelectContainer');
        const modelSelect = document.getElementById('modelSelect');
        const modelInputContainer = document.getElementById('modelInputContainer');
        const modelInput = document.getElementById('modelInput');

        // API Anahtar InputlarÄ±
        const apiKeysInputs = {
            openrouter: document.getElementById('openrouterApiKey'),
            openai: document.getElementById('openaiApiKey'),
            gemini: document.getElementById('geminiApiKey'),
            groq: document.getElementById('groqApiKey'),
            claude: document.getElementById('claudeApiKey'),
            deepseek: document.getElementById('deepseekApiKey'),
            qwen: document.getElementById('qwenApiKey')
        };

        // --- Sohbet GeÃ§miÅŸi ---
        let conversationHistory = [];

        // --- API YapÄ±landÄ±rmalarÄ± ---
        const apiConfigs = {
             openrouter: {
                 apiKeyInput: apiKeysInputs.openrouter,
                 endpoint: 'https://openrouter.ai/api/v1/chat/completions',
                 buildHeaders: (apiKey) => ({
                     'Content-Type': 'application/json',
                     'Authorization': `Bearer ${apiKey}`,
                     // 'HTTP-Referer': 'YOUR_SITE_URL', // Ä°steÄŸe baÄŸlÄ±
                     // 'X-Title': 'YOUR_SITE_NAME' // Ä°steÄŸe baÄŸlÄ±
                 }),
                 buildBody: (model, history) => ({
                     model: model,
                     messages: history.map(msg => ({
                         role: msg.role === 'model' ? 'assistant' : msg.role,
                         content: msg.content
                     }))
                 }),
                 parseResponse: (data) => data.choices?.[0]?.message?.content?.trim()
             },
            openai: {
                apiKeyInput: apiKeysInputs.openai,
                models: ["gpt-4o", "gpt-4-turbo", "gpt-3.5-turbo"],
                endpoint: 'https://api.openai.com/v1/chat/completions',
                buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` }),
                buildBody: (model, history) => ({ model: model, messages: history.map(msg => ({ role: msg.role === 'model' ? 'assistant' : msg.role, content: msg.content })) }),
                parseResponse: (data) => data.choices?.[0]?.message?.content?.trim()
            },
             gemini: {
                 apiKeyInput: apiKeysInputs.gemini,
                 models: ["gemini-1.5-flash-latest", "gemini-1.5-pro-latest", "gemini-pro"],
                 getEndpoint: (model, apiKey) => `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`,
                 buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json' }),
                 buildBody: (model, history) => ({ contents: history.map(msg => ({ role: msg.role === 'assistant' ? 'model' : msg.role, parts: [{ text: msg.content }] })) }),
                 parseResponse: (data) => data.candidates?.[0]?.content?.parts?.[0]?.text?.trim(),
                 useModelRole: true
            },
             groq: {
                apiKeyInput: apiKeysInputs.groq,
                models: ["llama3-8b-8192", "llama3-70b-8192", "mixtral-8x7b-32768", "gemma-7b-it"],
                endpoint: 'https://api.groq.com/openai/v1/chat/completions',
                buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` }),
                buildBody: (model, history) => ({ model: model, messages: history.map(msg => ({ role: msg.role === 'model' ? 'assistant' : msg.role, content: msg.content })) }),
                parseResponse: (data) => data.choices?.[0]?.message?.content?.trim()
            },
             claude: {
                 apiKeyInput: apiKeysInputs.claude,
                 models: ["claude-3-opus-20240229", "claude-3-sonnet-20240229", "claude-3-haiku-20240307"],
                 endpoint: 'https://api.anthropic.com/v1/messages',
                 buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json', 'x-api-key': apiKey, 'anthropic-version': '2023-06-01' }),
                 buildBody: (model, history) => ({ model: model, max_tokens: 1024, messages: history.map(msg => ({ role: msg.role === 'model' ? 'assistant' : msg.role, content: msg.content })) }),
                 parseResponse: (data) => data.content?.[0]?.text?.trim()
             },
              deepseek: {
                apiKeyInput: apiKeysInputs.deepseek,
                models: ["deepseek-chat", "deepseek-coder"],
                endpoint: 'https://api.deepseek.com/chat/completions',
                buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` }),
                buildBody: (model, history) => ({ model: model, messages: history.map(msg => ({ role: msg.role === 'model' ? 'assistant' : msg.role, content: msg.content })) }),
                parseResponse: (data) => data.choices?.[0]?.message?.content?.trim()
            },
             qwen: {
                apiKeyInput: apiKeysInputs.qwen,
                models: ["qwen-turbo", "qwen-plus", "qwen-max"],
                endpoint: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation',
                buildHeaders: (apiKey) => ({ 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` }),
                buildBody: (model, history) => ({ model: model, input: { messages: history.map(msg => ({ role: msg.role === 'model' ? 'assistant' : msg.role, content: msg.content }))}, parameters: {} }),
                parseResponse: (data) => data.output?.choices?.[0]?.message?.content?.trim() || data.output?.text?.trim()
             }
        };

        // --- YardÄ±mcÄ± Fonksiyonlar ---

        /**
         * Basit Markdown formatlamasÄ±nÄ± (kalÄ±n, italik, satÄ±r iÃ§i kod, listeler) HTML'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.
         * Dikkat: Bu tam bir Markdown ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ± deÄŸildir, temel durumlarÄ± ele alÄ±r.
         * Kod bloklarÄ± (```) bu fonksiyon Ã‡AÄRILMADAN Ã–NCE ayrÄ±lmalÄ±dÄ±r.
         * @param {string} rawText - Ham metin girdisi.
         * @returns {string} - HTML formatÄ±nda Ã§Ä±ktÄ±.
         */
        function parseMarkdown(rawText) {
            if (!rawText) return '';

            let html = '';
            const lines = rawText.trim().split('\n');
            let listType = null; // null, 'ul', 'ol'
            let listLevel = 0; // Mevcut liste girinti seviyesi
            let paragraphBuffer = []; // ArdÄ±ÅŸÄ±k metin satÄ±rlarÄ± iÃ§in tampon

            // SatÄ±r iÃ§i formatlamayÄ± (bold, italic, code) uygular
            function applyInlineFormatting(lineContent) {
                // SatÄ±r iÃ§i kod (`...`)
                lineContent = lineContent.replace(/`([^`]+?)`/g, '<code>$1</code>');
                // KalÄ±n+Ä°talik (***...*** veya ___...___)
                lineContent = lineContent.replace(/(?<!\\)\*\*\*([^\*]+?)\*\*\*/g, '<strong><em>$1</em></strong>');
                lineContent = lineContent.replace(/(?<!\\)___([^_]+?)___/g, '<strong><em>$1</em></strong>');
                // KalÄ±n (**...** veya __...__)
                lineContent = lineContent.replace(/(?<!\\)\*\*([^\*]+?)\*\*/g, '<strong>$1</strong>');
                lineContent = lineContent.replace(/(?<!\\)__([^_]+?)__/g, '<strong>$1</strong>');
                // Ä°talik (*...* veya _..._)
                lineContent = lineContent.replace(/(?<!\\)\*([^\*]+?)\*/g, '<em>$1</em>');
                lineContent = lineContent.replace(/(?<!\\)_([^_]+?)_/g, '<em>$1</em>');
                // KaÃ§Ä±ÅŸ karakterleri (\*, \_)
                lineContent = lineContent.replace(/\\\*/g, '*');
                lineContent = lineContent.replace(/\\_/g, '_');
                lineContent = lineContent.replace(/\\`/g, '`');
                return lineContent;
            }

            // Paragraf tamponunu HTML'e boÅŸaltÄ±r
            function flushParagraphBuffer() {
                if (paragraphBuffer.length > 0) {
                    // Her satÄ±ra formatlama uygula ve <br> ile birleÅŸtir, sonra <p> iÃ§ine al
                    const paragraphContent = paragraphBuffer.map(applyInlineFormatting).join('<br>');
                     html += `<p>${paragraphContent}</p>\n`;
                     paragraphBuffer = [];
                }
            }

            // Gerekiyorsa aÃ§Ä±k olan listeyi/listeleri kapatÄ±r
            function closeLists(targetLevel = 0) {
                 while (listLevel > targetLevel) {
                    if (listType === 'ul') { html += '</ul>\n'; }
                    else if (listType === 'ol') { html += '</ol>\n'; }
                    listLevel--;
                    // TODO: Ãœst seviyedeki listelerin tipini takip etmek gerekir (ÅŸu an basit varsayÄ±m)
                 }
                 if (listLevel === 0) listType = null;
            }

            lines.forEach(line => {
                const trimmedLine = line.trim();
                // Girintiyi ve liste iÅŸaretÃ§isini yakala (daha iyi seviye)
                const listMatch = line.match(/^(\s*)(([\*\-\+])|(\d+)\.)\s+(.*)/);
                let currentLevel = 0;
                let currentListType = null;
                let content = '';

                if (listMatch) {
                    const indentSpaces = listMatch[1].length;
                    // Basit girinti seviyesi tahmini (her 2-4 boÅŸluk iÃ§in bir seviye artÄ±r)
                    currentLevel = Math.floor(indentSpaces / 2) + 1; // 2 boÅŸluk = 1 seviye
                    content = listMatch[5];
                    currentListType = listMatch[3] ? 'ul' : 'ol'; // *, -, + ise ul, sayÄ± ise ol
                }

                if (listMatch) {
                    flushParagraphBuffer(); // Ã–nceki paragrafÄ± bitir

                    if (currentLevel > listLevel) { // Yeni iÃ§ liste
                         if(listLevel > 0 && listType !== currentListType){
                            // Ä°Ã§ iÃ§e farklÄ± tipte liste pek standart deÄŸil, ama yine de yeni baÅŸlat
                         }
                         html += (currentListType === 'ul' ? '<ul>\n' : '<ol>\n');
                         listLevel = currentLevel;
                         listType = currentListType;
                    } else if (currentLevel < listLevel) { // Ãœst seviyeye dÃ¶n
                         closeLists(currentLevel);
                         // Seviye deÄŸiÅŸtiÄŸinde tip de deÄŸiÅŸmiÅŸ olabilir, kontrol et
                         if(listType !== currentListType) {
                             closeLists(currentLevel - 1); // KapatÄ±p yeni tip aÃ§
                             html += (currentListType === 'ul' ? '<ul>\n' : '<ol>\n');
                             listLevel = currentLevel;
                             listType = currentListType;
                         }
                    } else if (listType !== currentListType) { // AynÄ± seviye ama tip deÄŸiÅŸti
                         closeLists(currentLevel - 1); // KapatÄ±p yeni tip aÃ§
                         html += (currentListType === 'ul' ? '<ul>\n' : '<ol>\n');
                         listLevel = currentLevel;
                         listType = currentListType;
                    }

                    html += `<li>${applyInlineFormatting(content)}</li>\n`; // Liste Ã¶ÄŸesini ekle
                } else {
                    // Liste Ã¶ÄŸesi deÄŸilse
                    closeLists(); // AÃ§Ä±k tÃ¼m listeleri kapat
                    if (trimmedLine) {
                        // BoÅŸ olmayan satÄ±rlarÄ± paragrafa ekle
                        paragraphBuffer.push(line); // Orijinal satÄ±rÄ± al
                    } else {
                        // BoÅŸ satÄ±r -> paragraf sonu
                        flushParagraphBuffer();
                    }
                }
            });

            // DÃ¶ngÃ¼ sonrasÄ± kalanlarÄ± temizle
            flushParagraphBuffer();
            closeLists();

            return html.trim(); // SonuÃ§ HTML'i dÃ¶ndÃ¼r
        }

        // --- GÃœNCELLENMÄ°Å addMessageToChatbox Fonksiyonu ---
        function addMessageToChatbox(sender, message, provider = null, type = 'normal') {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');

            if (type === 'error') {
                messageDiv.classList.add('error-message');
                messageDiv.textContent = `âŒ Hata (${provider || 'Sistem'}): ${message}`;
            } else if (type === 'loading') {
                messageDiv.classList.add('ai-message', 'loading-message');
                messageDiv.innerHTML = `<span class="sender-tag">${provider || 'AI'} yazÄ±yor...</span>â³`;
                messageDiv.id = 'loading-indicator';
            } else {
                // Normal mesaj (KullanÄ±cÄ± veya AI)
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');

                // AI mesajÄ±ysa Ã¶zel iÅŸlem yap (Sistem mesajlarÄ± hariÃ§)
                if (sender !== 'user' && provider !== 'Sistem') {
                    // Ã–nce gÃ¶nderen etiketi ekle
                    const senderTag = document.createElement('span');
                    senderTag.classList.add('sender-tag');
                    senderTag.textContent = provider || 'AI';
                    messageDiv.appendChild(senderTag);

                    // Ä°Ã§erik iÃ§in bir ana div oluÅŸtur (bu, kod bloÄŸu dÄ±ÅŸÄ± iÃ§eriÄŸi kapsayacak)
                    const contentWrapperDiv = document.createElement('div');

                    // ```lang\ncode\n``` formatÄ±nÄ± ara
                    const codeBlockRegex = /```(\w*)\n([\s\S]*?)\n```/g; // Global flag Ã¶nemli
                    let lastIndex = 0;
                    let match;
                    let hasContent = false; // Mesaj div'ine iÃ§erik eklendi mi?

                    // Kod bloklarÄ±nÄ± ve aralarÄ±ndaki metinleri ayÄ±r
                    while ((match = codeBlockRegex.exec(message)) !== null) {
                        // Kod bloÄŸundan Ã¶nceki metin kÄ±smÄ±
                        const textPart = message.substring(lastIndex, match.index).trim();
                        if (textPart) {
                            // Ã–nceki iÃ§erik wrapper'Ä±na markdown'Ä± ekle
                            const parsedHtml = parseMarkdown(textPart);
                            if (parsedHtml) {
                                contentWrapperDiv.innerHTML += parsedHtml; // Mevcut iÃ§eriÄŸe ekle
                                hasContent = true;
                            }
                        }

                        // Mesaj div'ine (varsa) Ã¶nceki metinleri iÃ§eren wrapper'Ä± ekle
                        if (contentWrapperDiv.innerHTML.trim()) {
                             messageDiv.appendChild(contentWrapperDiv.cloneNode(true)); // Klonlayarak ekle
                             contentWrapperDiv.innerHTML = ''; // Bir sonraki metin bÃ¶lÃ¼mÃ¼ iÃ§in temizle
                        }


                        // Kod BloÄŸu
                        const lang = match[1] || 'text';
                        const codeContent = match[2]; // Kodu trim etme!

                        const codeWrapper = document.createElement('div');
                        codeWrapper.className = 'code-wrapper';

                        const toolbar = document.createElement('div');
                        toolbar.className = 'code-toolbar';

                        const langSpan = document.createElement('span'); // Dil etiketi
                        langSpan.className = 'code-lang';
                        langSpan.textContent = lang;

                        const buttonGroup = document.createElement('div'); // ButonlarÄ± grupla

                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'copy-btn';
                        copyBtn.title = 'Kodu Kopyala';
                        copyBtn.innerHTML = 'ğŸ“„<span class="btn-text">Kopyala</span>'; // Ä°kon + Metin
                        copyBtn.dataset.code = codeContent; // Kodu data attribute olarak ekle

                        const downloadBtn = document.createElement('button');
                        downloadBtn.className = 'download-btn';
                        downloadBtn.title = 'Kodu Ä°ndir';
                        downloadBtn.innerHTML = 'ğŸ’¾<span class="btn-text">Ä°ndir</span>'; // Ä°kon + Metin
                        downloadBtn.dataset.code = codeContent;
                        downloadBtn.dataset.lang = lang; // Dil bilgisini de ekle

                        buttonGroup.appendChild(copyBtn);
                        buttonGroup.appendChild(downloadBtn);

                        toolbar.appendChild(langSpan); // Dil etiketini ekle
                        toolbar.appendChild(buttonGroup); // Buton grubunu ekle

                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        // Sintaks highlight iÃ§in class (isteÄŸe baÄŸlÄ±, kÃ¼tÃ¼phane gerektirir)
                        code.className = `language-${lang}`;
                        code.textContent = codeContent; // Kodu gÃ¼venli ÅŸekilde ekle

                        pre.appendChild(code);
                        codeWrapper.appendChild(toolbar);
                        codeWrapper.appendChild(pre);
                        messageDiv.appendChild(codeWrapper); // Kod bloÄŸunu doÄŸrudan mesaj div'ine ekle
                        hasContent = true;
                        // --- Kod BloÄŸu HTML BitiÅŸ ---

                        lastIndex = codeBlockRegex.lastIndex; // Sonraki aramaya devam et
                    }

                    // Son kod bloÄŸundan sonra kalan metin kÄ±smÄ±
                    const remainingText = message.substring(lastIndex).trim();
                    if (remainingText) {
                         const parsedHtml = parseMarkdown(remainingText);
                         if (parsedHtml) {
                            contentWrapperDiv.innerHTML += parsedHtml; // Kalan metni wrapper'a ekle
                            hasContent = true;
                        }
                    }

                    // EÄŸer son metin bÃ¶lÃ¼mÃ¼ varsa, onu da mesaj div'ine ekle
                    if (contentWrapperDiv.innerHTML.trim()) {
                         messageDiv.appendChild(contentWrapperDiv);
                    }


                     // EÄŸer regex hiÃ§ eÅŸleÅŸmediyse (kod bloÄŸu yoksa) tÃ¼m mesajÄ± iÅŸle
                     if (lastIndex === 0 && message.trim() && !hasContent) {
                         const parsedHtml = parseMarkdown(message.trim());
                         if(parsedHtml) {
                             contentWrapperDiv.innerHTML = parsedHtml;
                             messageDiv.appendChild(contentWrapperDiv);
                             hasContent = true;
                         } else if (message.trim()) { // Markdown yoksa dÃ¼z metin olarak ekle
                             contentWrapperDiv.textContent = message.trim();
                             messageDiv.appendChild(contentWrapperDiv);
                             hasContent = true;
                         }
                     }

                     // EÄŸer hiÃ§bir iÃ§erik eklenmediyse (mesaj tamamen boÅŸ veya sadece whitespace ise)
                     if (!hasContent && message.trim().length === 0) {
                         // BoÅŸ mesajÄ± gÃ¶stermemek iÃ§in bir ÅŸey yapma
                         // veya Ã¶zel bir mesaj gÃ¶ster:
                         // const emptyDiv = document.createElement('div');
                         // emptyDiv.textContent = "[BoÅŸ yanÄ±t]";
                         // emptyDiv.style.fontStyle = 'italic';
                         // messageDiv.appendChild(emptyDiv);
                     } else if (!hasContent && message.trim().length > 0) {
                         // Parse edilemeyen veya sadece boÅŸluk olan ama boÅŸ olmayan mesaj
                         const fallbackDiv = document.createElement('div');
                         fallbackDiv.textContent = message.trim();
                         messageDiv.appendChild(fallbackDiv);
                     }


                } else { // KullanÄ±cÄ± veya Sistem mesajÄ± ise direkt ekle (Markdown olmadan)
                    if (sender !== 'user') { // Sistem mesajÄ± iÃ§in gÃ¶nderen etiketi
                        const senderTag = document.createElement('span');
                        senderTag.classList.add('sender-tag');
                        senderTag.textContent = provider || 'AI'; // 'Sistem' olabilir
                        messageDiv.appendChild(senderTag);
                    }
                    const contentDiv = document.createElement('div');
                    // KullanÄ±cÄ± girdisini veya sistem mesajÄ±nÄ± gÃ¼venli bir ÅŸekilde ekle
                    contentDiv.textContent = message.trim(); // innerHTML yerine textContent kullan!
                    messageDiv.appendChild(contentDiv);
                }
            }

            // Mesaj kutusunu sadece gerÃ§ekten iÃ§erik varsa ekle
            // (Ã–rn: Hata veya yÃ¼kleniyor mesajÄ± deÄŸilse ve AI yanÄ±tÄ± boÅŸ deÄŸilse)
            if (messageDiv.innerHTML.trim() !== '' || type === 'error' || type === 'loading') {
                 chatbox.appendChild(messageDiv);
                 // En alta kaydÄ±r
                 chatbox.scrollTop = chatbox.scrollHeight;
            }
            return messageDiv;
        }


        // SeÃ§ilen saÄŸlayÄ±cÄ±ya gÃ¶re Model SeÃ§im ArayÃ¼zÃ¼nÃ¼ gÃ¼ncelle
        function updateModelUI() {
            const selectedProvider = aiProviderSelect.value;
            const config = apiConfigs[selectedProvider];

            if (selectedProvider === 'openrouter') {
                modelSelectContainer.style.display = 'none';
                modelInputContainer.style.display = 'block';
                modelInput.value = localStorage.getItem('openrouter_last_model') || ''; // KayÄ±tlÄ± modeli yÃ¼kle
            } else {
                modelInputContainer.style.display = 'none';
                modelSelectContainer.style.display = 'block';

                modelSelect.innerHTML = '';
                if (config && config.models && config.models.length > 0) {
                    config.models.forEach(modelName => {
                        const option = document.createElement('option');
                        option.value = modelName;
                        option.textContent = modelName;
                        modelSelect.appendChild(option);
                    });
                    modelSelect.disabled = false;
                    // KayÄ±tlÄ± modeli seÃ§ (varsa)
                     const savedModel = localStorage.getItem(`${selectedProvider}_last_model`);
                     if (savedModel && config.models.includes(savedModel)) {
                         modelSelect.value = savedModel;
                     }

                } else {
                    const option = document.createElement('option');
                    option.textContent = "Model Yok/TanÄ±msÄ±z";
                    option.value = ""; // DeÄŸeri boÅŸ olsun
                    modelSelect.appendChild(option);
                    modelSelect.disabled = true;
                    console.warn(`"${selectedProvider}" iÃ§in model listesi bulunamadÄ± veya tanÄ±msÄ±z.`);
                }
            }
             // BaÅŸlangÄ±Ã§ta veya saÄŸlayÄ±cÄ± deÄŸiÅŸtiÄŸinde sohbet geÃ§miÅŸini temizle (isteÄŸe baÄŸlÄ±)
             // conversationHistory = [];
             // chatbox.innerHTML = ''; // Sohbet kutusunu temizle
             // addMessageToChatbox('Sistem', 'Sohbet geÃ§miÅŸi temizlendi. Yeni saÄŸlayÄ±cÄ±/model seÃ§ildi.', 'Sistem');
        }


        // --- Ana Sohbet Fonksiyonu ---
        async function sendMessage() {
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            const selectedProvider = aiProviderSelect.value;
            const config = apiConfigs[selectedProvider];

            if (!config) {
                addMessageToChatbox('Sistem', 'GeÃ§ersiz AI saÄŸlayÄ±cÄ±sÄ± seÃ§ildi.', selectedProvider, 'error');
                return;
            }

            let selectedModel;
            if (selectedProvider === 'openrouter') {
                selectedModel = modelInput.value.trim();
                if (!selectedModel) {
                     addMessageToChatbox('Sistem', 'LÃ¼tfen OpenRouter iÃ§in bir model adÄ± girin (Ã¶rn: google/gemini-pro).', 'OpenRouter', 'error');
                     modelInput.focus();
                     return;
                 }
                 localStorage.setItem('openrouter_last_model', selectedModel); // Modeli kaydet
            } else {
                selectedModel = modelSelect.value;
                 if (!selectedModel || modelSelect.disabled) { // BoÅŸ deÄŸer veya disabled kontrolÃ¼
                    addMessageToChatbox('Sistem', 'LÃ¼tfen geÃ§erli bir model seÃ§in.', selectedProvider, 'error');
                    modelSelect.focus();
                    return;
                }
                 localStorage.setItem(`${selectedProvider}_last_model`, selectedModel); // Modeli kaydet
            }

            const apiKey = config.apiKeyInput.value.trim();
            if (!apiKey) {
                addMessageToChatbox('Sistem', `LÃ¼tfen ${selectedProvider.toUpperCase()} iÃ§in API anahtarÄ±nÄ± girin.`, selectedProvider, 'error');
                config.apiKeyInput.focus();
                return;
            }
            // API AnahtarÄ±nÄ± (geÃ§ici olarak) local storage'a kaydet (UYARI: GÃœVENLÄ° DEÄÄ°L)
             localStorage.setItem(`${selectedProvider}_api_key`, apiKey);


            addMessageToChatbox('user', userMessage, 'User');
            conversationHistory.push({ role: "user", content: userMessage });
            userInput.value = '';
            sendButton.disabled = true;

            const providerName = selectedProvider.charAt(0).toUpperCase() + selectedProvider.slice(1); // Ä°lk harfi bÃ¼yÃ¼k
            const loadingMessageElement = addMessageToChatbox('ai', 'AI yazÄ±yor...', providerName, 'loading');

            try {
                const endpoint = config.getEndpoint ? config.getEndpoint(selectedModel, apiKey) : config.endpoint;
                const headers = config.buildHeaders(apiKey);
                const body = config.buildBody(selectedModel, conversationHistory);

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(body)
                });

                // Ã–nce yÃ¼kleniyor mesajÄ±nÄ± kaldÄ±r
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator && loadingIndicator.parentNode === chatbox) { // Hala DOM'da ise kaldÄ±r
                     chatbox.removeChild(loadingIndicator);
                }


                if (!response.ok) {
                    let errorData;
                    let errorMessage = `API isteÄŸi baÅŸarÄ±sÄ±z oldu. Status: ${response.status} ${response.statusText}`;
                    try {
                        errorData = await response.json();
                        errorMessage = errorData?.error?.message // OpenAI, Groq, OpenRouter
                                       || errorData?.error?.details // Bazen Gemini
                                       || (errorData?.error && typeof errorData.error === 'string' ? errorData.error : null) // Bazen Claude
                                       || errorData?.message    // Gemini (bazen), Claude (bazen)
                                       || errorData?.detail     // BazÄ± API'ler
                                       || JSON.stringify(errorData); // Son Ã§are
                    } catch (e) {
                        try {
                             const textError = await response.text();
                             if(textError) errorMessage = textError; // JSON deÄŸilse text olarak oku
                        }
                        catch (readError) {} // Okuma hatasÄ± olursa Ã¶nceki mesaj kalsÄ±n
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                const aiMessage = config.parseResponse(data);

                if (aiMessage !== null && aiMessage !== undefined) { // BoÅŸ string geÃ§erli olabilir
                    // AI mesajÄ±nÄ± iÅŸlenmiÅŸ olarak ekle (kod bloklarÄ± ve markdown ayrÄ±ÅŸtÄ±rÄ±lacak)
                    addMessageToChatbox('ai', aiMessage, providerName);
                    const assistantRole = config.useModelRole ? 'model' : 'assistant';
                    conversationHistory.push({ role: assistantRole, content: aiMessage });
                } else {
                    console.error("API YanÄ±tÄ± (AyrÄ±ÅŸtÄ±rma SonrasÄ± Ä°Ã§erik Yok veya null/undefined):", data);
                    // YanÄ±t var ama iÃ§erik parse edilemediyse veya boÅŸsa kullanÄ±cÄ±ya bildir
                    let rawResponseInfo = '';
                    try { rawResponseInfo = JSON.stringify(data).substring(0, 200) + '...'; } catch { rawResponseInfo = '[JSON olmayan yanÄ±t]';}
                    addMessageToChatbox('Sistem', `AI'dan geÃ§erli bir metin yanÄ±tÄ± alÄ±namadÄ±. YanÄ±t formatÄ± beklenenden farklÄ± olabilir veya yanÄ±t boÅŸ. (Raw: ${rawResponseInfo})`, providerName, 'error');
                     // GeÃ§miÅŸe boÅŸ mesaj eklememek iyi olabilir
                }

            } catch (error) {
                // YÃ¼kleniyor mesajÄ± zaten yukarÄ±da kaldÄ±rÄ±ldÄ±, tekrar kontrol etmeye gerek yok
                // (Hala duruyorsa kaldÄ±r)
                const loadingIndicator = document.getElementById('loading-indicator');
                 if (loadingIndicator && loadingIndicator.parentNode === chatbox) {
                     chatbox.removeChild(loadingIndicator);
                 }

                console.error(`[${providerName}] API HatasÄ±:`, error);
                addMessageToChatbox('Sistem', `Bir hata oluÅŸtu: ${error.message}`, providerName, 'error');
                // Hata durumunda son kullanÄ±cÄ± mesajÄ±nÄ± geÃ§miÅŸten sil (opsiyonel)
                // conversationHistory.pop();
            } finally {
                sendButton.disabled = false;
                userInput.focus();
                // Sohbet kutusunu en alta kaydÄ±r (hatadan sonra da)
                 chatbox.scrollTop = chatbox.scrollHeight;
            }
        }

        // --- Olay Dinleyicileri ---
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function (e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }); // Shift+Enter ile satÄ±r atla
        aiProviderSelect.addEventListener('change', updateModelUI);
        modelInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && aiProviderSelect.value === 'openrouter') {
                sendMessage();
            }
        });
         modelSelect.addEventListener('change', (event) => {
             const provider = aiProviderSelect.value;
             if (provider !== 'openrouter') {
                 localStorage.setItem(`${provider}_last_model`, event.target.value);
             }
         });
         modelInput.addEventListener('change', (event) => {
             if (aiProviderSelect.value === 'openrouter') {
                 localStorage.setItem('openrouter_last_model', event.target.value);
             }
         });


        // --- Kod BloÄŸu ButonlarÄ± iÃ§in Olay Dinleyicisi ---
        chatbox.addEventListener('click', function(event) {
            const target = event.target; // TÄ±klanan element

            // Kopyala butonu mu tÄ±klandÄ±?
            const copyButton = target.closest('.copy-btn');
            if (copyButton && !copyButton.disabled) { // Buton disabled deÄŸilse Ã§alÄ±ÅŸsÄ±n
                const codeToCopy = copyButton.dataset.code;
                navigator.clipboard.writeText(codeToCopy).then(() => {
                    const btnText = copyButton.querySelector('.btn-text');
                    if (btnText) btnText.textContent = 'KopyalandÄ±!';
                    copyButton.disabled = true; // KopyalayÄ±nca butonu devre dÄ±ÅŸÄ± bÄ±rak
                    setTimeout(() => {
                         if (btnText) btnText.textContent = 'Kopyala';
                         copyButton.disabled = false; // 2 saniye sonra tekrar aktif et
                    }, 2000);
                }).catch(err => {
                    console.error('Kod kopyalanamadÄ±:', err);
                    // Eski yÃ¶ntem (gÃ¼venli olmayan contextlerde fallback)
                     try {
                         const textArea = document.createElement("textarea");
                         textArea.value = codeToCopy;
                         textArea.style.position = "fixed"; // GÃ¶rÃ¼nmez yap
                         textArea.style.left = "-9999px";
                         document.body.appendChild(textArea);
                         textArea.focus();
                         textArea.select();
                         document.execCommand('copy');
                         document.body.removeChild(textArea);

                         // BaÅŸarÄ± geri bildirimi (fallback iÃ§in)
                         const btnText = copyButton.querySelector('.btn-text');
                         if (btnText) btnText.textContent = 'KopyalandÄ±! (FB)';
                         copyButton.disabled = true;
                         setTimeout(() => {
                            if (btnText) btnText.textContent = 'Kopyala';
                            copyButton.disabled = false;
                         }, 2000);
                     } catch (fallbackErr) {
                         console.error('Fallback kopyalama da baÅŸarÄ±sÄ±z:', fallbackErr);
                         alert('Hata: Kod panoya kopyalanamadÄ±!');
                     }
                });
                return; // Ä°ÅŸlem tamamlandÄ±
            }

            // Ä°ndir butonu mu tÄ±klandÄ±?
            const downloadButton = target.closest('.download-btn');
            if (downloadButton) {
                const codeToDownload = downloadButton.dataset.code;
                const lang = downloadButton.dataset.lang || 'txt';
                // Dosya adÄ± iÃ§in daha anlamlÄ± bir ÅŸey (Ã¶rn: ilk satÄ±r veya rastgele id) eklenebilir
                const filename = `ai_kod_${Date.now()}.${lang.split(/[^a-zA-Z0-9]/)[0] || 'txt'}`; // Dil adÄ±ndan uzantÄ± tÃ¼ret, geÃ§ersiz karakterleri at

                try {
                    const blob = new Blob([codeToDownload], { type: 'text/plain;charset=utf-8' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;

                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href); // Bellek sÄ±zÄ±ntÄ±sÄ±nÄ± Ã¶nle
                } catch (err) {
                    console.error('Dosya indirilemedi:', err);
                    alert('Hata: Kod dosyasÄ± indirilemedi!');
                }
            }
        });
        // --- Kod BloÄŸu ButonlarÄ± iÃ§in Olay Dinleyicisi BitiÅŸ ---


        // --- BaÅŸlangÄ±Ã§ AyarlarÄ± ---
        // KayÄ±tlÄ± API AnahtarlarÄ±nÄ± yÃ¼kle (UYARI: GÃœVENLÄ° DEÄÄ°L!)
        Object.keys(apiKeysInputs).forEach(providerKey => {
             const savedKey = localStorage.getItem(`${providerKey}_api_key`);
             if (savedKey) {
                 apiKeysInputs[providerKey].value = savedKey;
             }
             // Anahtar deÄŸiÅŸtikÃ§e kaydet (tarayÄ±cÄ± kapatÄ±lana kadar tutar)
             apiKeysInputs[providerKey].addEventListener('input', (event) => {
                localStorage.setItem(`${providerKey}_api_key`, event.target.value);
             });
        });

        updateModelUI(); // Sayfa yÃ¼klendiÄŸinde doÄŸru model UI'Ä±nÄ± gÃ¶ster
        userInput.focus(); // KullanÄ±cÄ± giriÅŸine odaklan

    </script>

</body>
</html>